{"version":3,"sources":["../../src/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import {CustomParameterDecorator} from \"./CustomParameterDecorator\";\r\nimport {BaseDriver} from \"./driver/BaseDriver\";\r\nimport {ExpressDriver} from \"./driver/express/ExpressDriver\";\r\nimport {KoaDriver} from \"./driver/koa/KoaDriver\";\r\nimport {MetadataArgsStorage} from \"./metadata-builder/MetadataArgsStorage\";\r\nimport {RoutingControllers} from \"./RoutingControllers\";\r\nimport {RoutingControllersOptions} from \"./RoutingControllersOptions\";\r\nimport {ValidationOptions} from \"class-validator\";\r\nimport {importClassesFromDirectories} from \"./util/importClassesFromDirectories\";\r\n\r\n// -------------------------------------------------------------------------\r\n// Main exports\r\n// -------------------------------------------------------------------------\r\n\r\nexport * from \"./container\";\r\n\r\nexport * from \"./decorator/Authorized\";\r\nexport * from \"./decorator/Body\";\r\nexport * from \"./decorator/BodyParam\";\r\nexport * from \"./decorator/ContentType\";\r\nexport * from \"./decorator/Controller\";\r\nexport * from \"./decorator/CookieParam\";\r\nexport * from \"./decorator/CookieParams\";\r\nexport * from \"./decorator/Ctx\";\r\nexport * from \"./decorator/CurrentUser\";\r\nexport * from \"./decorator/Delete\";\r\nexport * from \"./decorator/Get\";\r\nexport * from \"./decorator/Head\";\r\nexport * from \"./decorator/Header\";\r\nexport * from \"./decorator/HeaderParam\";\r\nexport * from \"./decorator/HeaderParams\";\r\nexport * from \"./decorator/HttpCode\";\r\nexport * from \"./decorator/Interceptor\";\r\nexport * from \"./decorator/JsonController\";\r\nexport * from \"./decorator/Location\";\r\nexport * from \"./decorator/Method\";\r\nexport * from \"./decorator/Middleware\";\r\nexport * from \"./decorator/OnNull\";\r\nexport * from \"./decorator/OnUndefined\";\r\nexport * from \"./decorator/Param\";\r\nexport * from \"./decorator/Params\";\r\nexport * from \"./decorator/Patch\";\r\nexport * from \"./decorator/Post\";\r\nexport * from \"./decorator/Put\";\r\nexport * from \"./decorator/QueryParam\";\r\nexport * from \"./decorator/QueryParams\";\r\nexport * from \"./decorator/Redirect\";\r\nexport * from \"./decorator/RedirectOrRender\";\r\nexport * from \"./decorator/Render\";\r\nexport * from \"./decorator/Req\";\r\nexport * from \"./decorator/Res\";\r\nexport * from \"./decorator/ResponseClassTransformOptions\";\r\nexport * from \"./decorator/Session\";\r\nexport * from \"./decorator/State\";\r\nexport * from \"./decorator/UploadedFile\";\r\nexport * from \"./decorator/UploadedFiles\";\r\nexport * from \"./decorator/UseAfter\";\r\nexport * from \"./decorator/UseBefore\";\r\nexport * from \"./decorator/UseInterceptor\";\r\n\r\nexport * from \"./decorator-options/BodyOptions\";\r\nexport * from \"./decorator-options/ParamOptions\";\r\nexport * from \"./decorator-options/UploadOptions\";\r\n\r\nexport * from \"./http-error/HttpError\";\r\nexport * from \"./http-error/InternalServerError\";\r\nexport * from \"./http-error/BadRequestError\";\r\nexport * from \"./http-error/ForbiddenError\";\r\nexport * from \"./http-error/NotAcceptableError\";\r\nexport * from \"./http-error/MethodNotAllowedError\";\r\nexport * from \"./http-error/NotFoundError\";\r\nexport * from \"./http-error/UnauthorizedError\";\r\n\r\nexport * from \"./driver/express/ExpressMiddlewareInterface\";\r\nexport * from \"./driver/express/ExpressErrorMiddlewareInterface\";\r\nexport * from \"./driver/koa/KoaMiddlewareInterface\";\r\nexport * from \"./metadata-builder/MetadataArgsStorage\";\r\nexport * from \"./metadata/ActionMetadata\";\r\nexport * from \"./metadata/ControllerMetadata\";\r\nexport * from \"./metadata/InterceptorMetadata\";\r\nexport * from \"./metadata/MiddlewareMetadata\";\r\nexport * from \"./metadata/ParamMetadata\";\r\nexport * from \"./metadata/ResponseHandleMetadata\";\r\nexport * from \"./metadata/UseMetadata\";\r\n\r\nexport * from \"./RoutingControllersOptions\";\r\nexport * from \"./CustomParameterDecorator\";\r\nexport * from \"./RoleChecker\";\r\nexport * from \"./Action\";\r\nexport * from \"./InterceptorInterface\";\r\n\r\nexport * from \"./driver/BaseDriver\";\r\nexport * from \"./driver/express/ExpressDriver\";\r\nexport * from \"./driver/koa/KoaDriver\";\r\n\r\n// -------------------------------------------------------------------------\r\n// Main Functions\r\n// -------------------------------------------------------------------------\r\n\r\n/**\r\n * Gets metadata args storage.\r\n * Metadata args storage follows the best practices and stores metadata in a global variable.\r\n */\r\nexport function getMetadataArgsStorage(): MetadataArgsStorage {\r\n    if (!(global as any).routingControllersMetadataArgsStorage)\r\n        (global as any).routingControllersMetadataArgsStorage = new MetadataArgsStorage();\r\n\r\n    return (global as any).routingControllersMetadataArgsStorage;\r\n}\r\n\r\n/**\r\n * Registers all loaded actions in your express application.\r\n */\r\nexport function useExpressServer<T>(expressApp: T, options?: RoutingControllersOptions): T {\r\n    const driver = new ExpressDriver(expressApp);\r\n    return createServer(driver, options);\r\n}\r\n\r\n/**\r\n * Registers all loaded actions in your express application.\r\n */\r\nexport function createExpressServer(options?: RoutingControllersOptions): any {\r\n    const driver = new ExpressDriver();\r\n    return createServer(driver, options);\r\n}\r\n\r\n/**\r\n * Registers all loaded actions in your koa application.\r\n */\r\nexport function useKoaServer<T>(koaApp: T, options?: RoutingControllersOptions): T {\r\n    const driver = new KoaDriver(koaApp);\r\n    return createServer(driver, options);\r\n}\r\n\r\n/**\r\n * Registers all loaded actions in your koa application.\r\n */\r\nexport function createKoaServer(options?: RoutingControllersOptions): any {\r\n    const driver = new KoaDriver();\r\n    return createServer(driver, options);\r\n}\r\n\r\n/**\r\n * Registers all loaded actions in your application using selected driver.\r\n */\r\nexport function createServer<T extends BaseDriver>(driver: T, options?: RoutingControllersOptions): any {\r\n    createExecutor(driver, options);\r\n    return driver.app;\r\n}\r\n\r\n/**\r\n * Registers all loaded actions in your express application.\r\n */\r\nexport function createExecutor<T extends BaseDriver>(driver: T, options: RoutingControllersOptions = {}): void {\r\n\r\n    // import all controllers and middlewares and error handlers (new way)\r\n    let controllerClasses: Function[];\r\n    if (options && options.controllers && options.controllers.length) {\r\n        controllerClasses = (options.controllers as any[]).filter(controller => controller instanceof Function);\r\n        const controllerDirs = (options.controllers as any[]).filter(controller => typeof controller === \"string\");\r\n        controllerClasses.push(...importClassesFromDirectories(controllerDirs));\r\n    }\r\n    let middlewareClasses: Function[];\r\n    if (options && options.middlewares && options.middlewares.length) {\r\n        middlewareClasses = (options.middlewares as any[]).filter(controller => controller instanceof Function);\r\n        const middlewareDirs = (options.middlewares as any[]).filter(controller => typeof controller === \"string\");\r\n        middlewareClasses.push(...importClassesFromDirectories(middlewareDirs));\r\n    }\r\n    let interceptorClasses: Function[];\r\n    if (options && options.interceptors && options.interceptors.length) {\r\n        interceptorClasses = (options.interceptors as any[]).filter(controller => controller instanceof Function);\r\n        const interceptorDirs = (options.interceptors as any[]).filter(controller => typeof controller === \"string\");\r\n        interceptorClasses.push(...importClassesFromDirectories(interceptorDirs));\r\n    }\r\n\r\n    if (options && options.development !== undefined) {\r\n        driver.developmentMode = options.development;\r\n    } else {\r\n        driver.developmentMode = process.env.NODE_ENV !== \"production\";\r\n    }\r\n\r\n    if (options.defaultErrorHandler !== undefined) {\r\n        driver.isDefaultErrorHandlingEnabled = options.defaultErrorHandler;\r\n    } else {\r\n        driver.isDefaultErrorHandlingEnabled = true;\r\n    }\r\n\r\n    if (options.classTransformer !== undefined) {\r\n        driver.useClassTransformer = options.classTransformer;\r\n    } else {\r\n        driver.useClassTransformer = true;\r\n    }\r\n\r\n    if (options.validation !== undefined) {\r\n        driver.enableValidation = !!options.validation;\r\n        if (options.validation instanceof Object)\r\n            driver.validationOptions = options.validation as ValidationOptions;\r\n\r\n    } else {\r\n        driver.enableValidation = true;\r\n    }\r\n\r\n    driver.classToPlainTransformOptions = options.classToPlainTransformOptions;\r\n    driver.plainToClassTransformOptions = options.plainToClassTransformOptions;\r\n\r\n    if (options.errorOverridingMap !== undefined)\r\n        driver.errorOverridingMap = options.errorOverridingMap;\r\n\r\n    if (options.routePrefix !== undefined)\r\n        driver.routePrefix = options.routePrefix;\r\n\r\n    if (options.currentUserChecker !== undefined)\r\n        driver.currentUserChecker = options.currentUserChecker;\r\n\r\n    if (options.authorizationChecker !== undefined)\r\n        driver.authorizationChecker = options.authorizationChecker;\r\n\r\n    driver.cors = options.cors;\r\n\r\n    // next create a controller executor\r\n    new RoutingControllers(driver, options)\r\n        .initialize()\r\n        .registerInterceptors(interceptorClasses)\r\n        .registerMiddlewares(\"before\", middlewareClasses)\r\n        .registerControllers(controllerClasses)\r\n        .registerMiddlewares(\"after\", middlewareClasses); // todo: register only for loaded controllers?\r\n}\r\n\r\n/**\r\n * Registers custom parameter decorator used in the controller actions.\r\n */\r\nexport function createParamDecorator(options: CustomParameterDecorator) {\r\n    return function(object: Object, method: string, index: number) {\r\n        getMetadataArgsStorage().params.push({\r\n            type: \"custom-converter\",\r\n            object: object,\r\n            method: method,\r\n            index: index,\r\n            parse: false,\r\n            required: options.required,\r\n            transform: options.value\r\n        });\r\n    };\r\n}\r\n"],"sourceRoot":"."}