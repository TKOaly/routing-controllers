{"version":3,"sources":["../../src/metadata-builder/MetadataBuilder.ts"],"names":[],"mappings":"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","file":"MetadataBuilder.js","sourcesContent":["import {ActionMetadata} from \"../metadata/ActionMetadata\";\r\nimport {ControllerMetadata} from \"../metadata/ControllerMetadata\";\r\nimport {InterceptorMetadata} from \"../metadata/InterceptorMetadata\";\r\nimport {MiddlewareMetadata} from \"../metadata/MiddlewareMetadata\";\r\nimport {ParamMetadata} from \"../metadata/ParamMetadata\";\r\nimport { ParamMetadataArgs } from \"../metadata/args/ParamMetadataArgs\";\r\nimport {ResponseHandlerMetadata} from \"../metadata/ResponseHandleMetadata\";\r\nimport { RoutingControllersOptions } from \"../RoutingControllersOptions\";\r\nimport {UseMetadata} from \"../metadata/UseMetadata\";\r\nimport {getMetadataArgsStorage} from \"../index\";\r\n\r\n/**\r\n * Builds metadata from the given metadata arguments.\r\n */\r\nexport class MetadataBuilder {\r\n\r\n    constructor(private options: RoutingControllersOptions) { }\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Public Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Builds controller metadata from a registered controller metadata args.\r\n     */\r\n    buildControllerMetadata(classes?: Function[]) {\r\n        return this.createControllers(classes);\r\n    }\r\n\r\n    /**\r\n     * Builds middleware metadata from a registered middleware metadata args.\r\n     */\r\n    buildMiddlewareMetadata(classes?: Function[]): MiddlewareMetadata[] {\r\n        return this.createMiddlewares(classes);\r\n    }\r\n\r\n    /**\r\n     * Builds interceptor metadata from a registered interceptor metadata args.\r\n     */\r\n    buildInterceptorMetadata(classes?: Function[]): InterceptorMetadata[] {\r\n        return this.createInterceptors(classes);\r\n    }\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Protected Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Creates middleware metadatas.\r\n     */\r\n    protected createMiddlewares(classes?: Function[]): MiddlewareMetadata[] {\r\n        const middlewares = !classes ? getMetadataArgsStorage().middlewares : getMetadataArgsStorage().filterMiddlewareMetadatasForClasses(classes);\r\n        return middlewares.map(middlewareArgs => new MiddlewareMetadata(middlewareArgs));\r\n    }\r\n\r\n    /**\r\n     * Creates interceptor metadatas.\r\n     */\r\n    protected createInterceptors(classes?: Function[]): InterceptorMetadata[] {\r\n        const interceptors = !classes ? getMetadataArgsStorage().interceptors : getMetadataArgsStorage().filterInterceptorMetadatasForClasses(classes);\r\n        return interceptors.map(interceptorArgs => new InterceptorMetadata({\r\n            target: interceptorArgs.target,\r\n            method: undefined,\r\n            interceptor: interceptorArgs.target\r\n        }));\r\n    }\r\n\r\n    /**\r\n     * Creates controller metadatas.\r\n     */\r\n    protected createControllers(classes?: Function[]): ControllerMetadata[] {\r\n        const controllers = !classes ? getMetadataArgsStorage().controllers : getMetadataArgsStorage().filterControllerMetadatasForClasses(classes);\r\n        return controllers.map(controllerArgs => {\r\n            const controller = new ControllerMetadata(controllerArgs);\r\n            controller.build(this.createControllerResponseHandlers(controller));\r\n            controller.actions = this.createActions(controller);\r\n            controller.uses = this.createControllerUses(controller);\r\n            controller.interceptors = this.createControllerInterceptorUses(controller);\r\n            return controller;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Creates action metadatas.\r\n     */\r\n    protected createActions(controller: ControllerMetadata): ActionMetadata[] {\r\n        return getMetadataArgsStorage()\r\n            .filterActionsWithTarget(controller.target)\r\n            .map(actionArgs => {\r\n                const action = new ActionMetadata(controller, actionArgs, this.options);\r\n                action.params = this.createParams(action);\r\n                action.uses = this.createActionUses(action);\r\n                action.interceptors = this.createActionInterceptorUses(action);\r\n                action.build(this.createActionResponseHandlers(action));\r\n                return action;\r\n            });\r\n    }\r\n\r\n    /**\r\n     * Creates param metadatas.\r\n     */\r\n    protected createParams(action: ActionMetadata): ParamMetadata[] {\r\n        return getMetadataArgsStorage()\r\n            .filterParamsWithTargetAndMethod(action.target, action.method)\r\n            .map(paramArgs => new ParamMetadata(action, this.decorateDefaultParamOptions(paramArgs)));\r\n    }\r\n\r\n    /**\r\n     * Decorate paramArgs with default settings\r\n     */\r\n    private decorateDefaultParamOptions(paramArgs: ParamMetadataArgs) {\r\n        let options = this.options.defaults && this.options.defaults.paramOptions;\r\n        if (!options)\r\n            return paramArgs;\r\n        \r\n        if (paramArgs.required === undefined)\r\n            paramArgs.required = options.required || false;\r\n\r\n        return paramArgs;\r\n    }\r\n\r\n    /**\r\n     * Creates response handler metadatas for action.\r\n     */\r\n    protected createActionResponseHandlers(action: ActionMetadata): ResponseHandlerMetadata[] {\r\n        return getMetadataArgsStorage()\r\n            .filterResponseHandlersWithTargetAndMethod(action.target, action.method)\r\n            .map(handlerArgs => new ResponseHandlerMetadata(handlerArgs));\r\n    }\r\n\r\n    /**\r\n     * Creates response handler metadatas for controller.\r\n     */\r\n    protected createControllerResponseHandlers(controller: ControllerMetadata): ResponseHandlerMetadata[] {\r\n        return getMetadataArgsStorage()\r\n            .filterResponseHandlersWithTarget(controller.target)\r\n            .map(handlerArgs => new ResponseHandlerMetadata(handlerArgs));\r\n    }\r\n\r\n    /**\r\n     * Creates use metadatas for actions.\r\n     */\r\n    protected createActionUses(action: ActionMetadata): UseMetadata[] {\r\n        return getMetadataArgsStorage()\r\n            .filterUsesWithTargetAndMethod(action.target, action.method)\r\n            .map(useArgs => new UseMetadata(useArgs));\r\n    }\r\n\r\n    /**\r\n     * Creates use interceptors for actions.\r\n     */\r\n    protected createActionInterceptorUses(action: ActionMetadata): InterceptorMetadata[] {\r\n        return getMetadataArgsStorage()\r\n            .filterInterceptorUsesWithTargetAndMethod(action.target, action.method)\r\n            .map(useArgs => new InterceptorMetadata(useArgs));\r\n    }\r\n\r\n    /**\r\n     * Creates use metadatas for controllers.\r\n     */\r\n    protected createControllerUses(controller: ControllerMetadata): UseMetadata[] {\r\n        return getMetadataArgsStorage()\r\n            .filterUsesWithTargetAndMethod(controller.target, undefined)\r\n            .map(useArgs => new UseMetadata(useArgs));\r\n    }\r\n\r\n    /**\r\n     * Creates use interceptors for controllers.\r\n     */\r\n    protected createControllerInterceptorUses(controller: ControllerMetadata): InterceptorMetadata[] {\r\n        return getMetadataArgsStorage()\r\n            .filterInterceptorUsesWithTargetAndMethod(controller.target, undefined)\r\n            .map(useArgs => new InterceptorMetadata(useArgs));\r\n    }\r\n\r\n}\r\n"],"sourceRoot":".."}